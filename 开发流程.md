# QQ水浒跨平台自动化项目 - 开发流程

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- 支持 Windows、macOS、Linux



### 2. 安装依赖

```bash
# 自动安装（推荐）- 会按顺序安装核心依赖和平台特定依赖
python install_requirements.py

# 手动安装 - 两步安装流程
# 步骤1: 安装核心跨平台依赖
pip install -r requirements.txt

# 步骤2: 根据平台安装特定依赖
# Windows用户:
pip install -r requirements-windows.txt
# macOS用户:
pip install -r requirements-macos.txt  
# Linux用户:
pip install -r requirements-linux.txt
```



### 3. 运行示例

```bash
# 基础示例
python examples/basic_example.py

# 高级示例  
python examples/advanced_example.py
```





## 📁 项目结构

```
qq-shuihu/
├── src/                     # 核心源代码
│   ├── utils/              # 核心工具模块
│   │   ├── api_core.py     # 主API接口
│   │   ├── automation_engine.py # 自动化引擎
│   │   ├── window_utils.py # 窗口管理
│   │   ├── task_manager.py # 任务系统
│   │   └── config_manager.py # 配置管理
│   └── __init__.py         # 包初始化
├── examples/               # 示例代码
├── test/                   # 测试文件
├── requirements*.txt       # 依赖文件
└── install_requirements.py # 自动安装脚本
```





## 🔧 二次开发

### 基础用法
创建文件：`src/my_automation.py`
```python
from utils import AutomationAPI, ClickMode, ImageMode

# 创建API实例
api = AutomationAPI()

try:
    # 启动系统
    api.start()
    
    # 设置模式
    api.set_click_mode(ClickMode.FOREGROUND)
    api.set_image_mode(ImageMode.FOREGROUND)
    
    # 查找窗口
    windows = api.find_windows_by_title("记事本")
    if windows:
        hwnd = windows[0].hwnd
        
        # 基础操作
        api.click(hwnd, 100, 100)
        api.send_text(hwnd, "Hello World")
        api.click_image(hwnd, "templates/button.png")  # 模板图片路径
        
finally:
    api.stop()
```

运行：`python src/my_automation.py`



### 扩展开发

创建文件：`src/my_custom_module.py`
```python
from utils import CrossPlatformAutomationEngine, CrossPlatformWindowManager, TaskManager

class MyAutomation(CrossPlatformAutomationEngine):
    def __init__(self):
        super().__init__()
        self.window_manager = CrossPlatformWindowManager()
        self.task_manager = TaskManager()
    
    def custom_operation(self, hwnd):
        # 实现自定义功能
        self.click(hwnd, 100, 100)
        self.send_text(hwnd, "自定义操作")
        
    def advanced_workflow(self, app_name):
        # 复杂工作流示例
        windows = self.window_manager.find_windows_by_title(app_name)
        if windows:
            hwnd = windows[0].hwnd
            self.custom_operation(hwnd)
            return True
        return False
```

使用文件：`src/my_custom_script.py`
```python
from my_custom_module import MyAutomation

# 使用自定义模块
automation = MyAutomation()
result = automation.advanced_workflow("记事本")
```

运行：`python src/my_custom_script.py`



### 任务系统

```python
# 创建任务
task_id = api.create_click_task(
    hwnd=hwnd,
    x=100, y=100,
    name="点击任务",
    max_retries=3
)

# 等待完成
result = api.wait_for_task(task_id, timeout=30)
```





## 🧪 测试

```bash
# 运行测试
python -m pytest test/ -v

# 测试覆盖率
python -m pytest test/ --cov=src
```





## 📝 开发规范

### 代码格式化
```bash
# 安装工具
pip install black isort flake8

# 格式化代码
black src/
isort src/
flake8 src/
```



### 跨平台兼容

```python
import platform

# 根据系统选择不同应用
if platform.system() == "Windows":
    target_app = "记事本"
elif platform.system() == "Darwin":  # macOS
    target_app = "TextEdit"
else:  # Linux
    target_app = "gedit"
```



## ❓ 常见问题

**Q: 找不到窗口？**
A: 确保目标应用已打开，使用正确的窗口标题

**Q: 权限问题？**
A: 
- macOS: 在"系统偏好设置" > "安全性与隐私" > "辅助功能"中添加权限
- Linux: 确保有X11访问权限

**Q: 图像识别失败？**
A: 
- 调整阈值 `threshold=0.8`
- 确保模板图像质量
- 检查图像路径

**Q: 后台模式不工作？**
A: 优先使用前台模式，跨平台兼容性更好



## 🔗 相关文件

- [README.md](README.md) - 项目说明和API文档
- [examples/](examples/) - 完整示例代码
- [requirements.txt](requirements.txt) - 依赖包列表
